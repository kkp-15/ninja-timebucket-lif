<!DOCTYPE html><html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚¿ã‚¤ãƒ ãƒã‚±ãƒƒãƒˆå¯è¦–åŒ–ãƒ„ãƒ¼ãƒ«</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f0f4f8;
      text-align: center;
      padding: 1rem;
    }
    input, button, select {
      margin: 0.5rem;
      padding: 0.5rem;
      font-size: 1rem;
    }
    table {
      margin: 1rem auto;
      border-collapse: collapse;
      width: 90%;
      max-width: 600px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 0.5rem;
    }
    th {
      background-color: #eee;
    }
    canvas {
      max-width: 600px;
      margin: 1rem auto;
    }
    footer {
      margin-top: 2rem;
      font-size: 0.9rem;
    }
    .x-share {
      margin-top: 1rem;
    }
    #totalHoursDisplay {
      font-size: 1rem;
      margin-top: 0.5rem;
    }
  </style>
</head>
<body>
  <h1>ã‚¿ã‚¤ãƒ ãƒã‚±ãƒƒãƒˆå¯è¦–åŒ–ãƒ„ãƒ¼ãƒ«</h1>  <div>
    <label>ç”Ÿå¹´æœˆæ—¥: <input type="date" id="birth"></label><br>
    <label>æƒ³å®šå¯¿å‘½: <input type="number" id="lifeExpectancy" value="80"> æ­³</label><br>
    <label>ã‚„ã‚ŠãŸã„ã“ã¨: <input type="text" id="taskInput">
    <label>æ‰€è¦æ™‚é–“ï¼ˆæ™‚é–“ï¼‰: <input type="number" id="taskHours" min="1" value="10">
    <button onclick="addTask()">è¿½åŠ </button></label>
    <div id="totalHoursDisplay"></div>
  </div>  <ul id="taskList"></ul><button onclick="calculateTime()">æ®‹ã‚Šæ™‚é–“ã‚’è¨ˆç®—</button>

  <div id="result"></div>
  <div class="x-share" id="shareButton" style="display: none;"></div>
  <canvas id="pieChart"></canvas>
  <canvas id="barChart"></canvas>  <footer>
    <p>ğŸ“ <a href="https://x.com/kkp_webninja" target="_blank">@kkp_webninja</a> ã‚’ãƒ•ã‚©ãƒ­ãƒ¼</p>
  </footer>  <script>
    const tasks = [];
    let pieChart, barChart;

    function addTask() {
      const name = document.getElementById('taskInput').value.trim();
      const hours = parseInt(document.getElementById('taskHours').value);
      if (name && hours > 0) {
        tasks.push({ name, hours });
        document.getElementById('taskInput').value = '';
        document.getElementById('taskHours').value = 10;
        renderTaskList();
        updateTotalHoursDisplay();
      }
    }

    function editTask(index) {
      const newName = prompt("æ–°ã—ã„ã‚„ã‚ŠãŸã„ã“ã¨ã®åå‰ã‚’å…¥åŠ›", tasks[index].name);
      const newHours = parseInt(prompt("æ‰€è¦æ™‚é–“ï¼ˆæ™‚é–“ï¼‰ã‚’å…¥åŠ›", tasks[index].hours));
      if (newName && newHours > 0) {
        tasks[index] = { name: newName, hours: newHours };
        renderTaskList();
        updateTotalHoursDisplay();
      }
    }

    function deleteTask(index) {
      if (confirm("ã“ã®é …ç›®ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")) {
        tasks.splice(index, 1);
        renderTaskList();
        updateTotalHoursDisplay();
      }
    }

    function renderTaskList() {
      const list = document.getElementById('taskList');
      list.innerHTML = '';
      tasks.forEach((task, i) => {
        const li = document.createElement('li');
        li.innerHTML = `
          <span>${task.name}ï¼ˆ${task.hours}æ™‚é–“ â‰’ ${(task.hours / 24).toFixed(1)}æ—¥ï¼‰</span>
          <button onclick="editTask(${i})">âœ</button>
          <button onclick="deleteTask(${i})">âŒ</button>
        `;
        list.appendChild(li);
      });
    }

    function updateTotalHoursDisplay() {
      const total = tasks.reduce((sum, t) => sum + t.hours, 0);
      const days = (total / 24).toFixed(1);
      document.getElementById('totalHoursDisplay').textContent = `ğŸ“ åˆè¨ˆæ‰€è¦æ™‚é–“: ${total.toLocaleString()} æ™‚é–“ï¼ˆç´„ ${days} æ—¥ï¼‰`;
    }

    function calculateTime() {
      const birth = new Date(document.getElementById('birth').value);
      const expectancy = parseInt(document.getElementById('lifeExpectancy').value);
      const today = new Date();
      const age = today.getFullYear() - birth.getFullYear() - ((today < new Date(today.getFullYear(), birth.getMonth(), birth.getDate())) ? 1 : 0);
      const remainingYears = expectancy - age;

      const sleepHoursPerDay = 7;
      const freeHoursPerDay = 24 - sleepHoursPerDay;
      const remainingDays = remainingYears * 365;
      const totalFreeHours = remainingDays * freeHoursPerDay;

      const usedHours = tasks.reduce((sum, t) => sum + t.hours, 0);
      const usedDays = (usedHours / 24).toFixed(1);
      const remainingFreeHours = totalFreeHours - usedHours;
      const remainingFreeDays = (remainingFreeHours / 24).toFixed(1);
      const usedPercent = ((usedHours / totalFreeHours) * 100).toFixed(1);
      const remainingPercent = (100 - usedPercent).toFixed(1);

      let html = `<p>ç¾åœ¨ ${age} æ­³ã€‚æ®‹ã‚Š ${remainingYears} å¹´ï¼ˆç´„ ${remainingDays.toLocaleString()} æ—¥ã€${totalFreeHours.toLocaleString()} æ™‚é–“ã®è‡ªç”±æ™‚é–“â€»ç¡çœ 7æ™‚é–“é™¤ãï¼‰ãŒã‚ã‚Šã¾ã™ã€‚</p>`;

      html += `<p>ğŸ“ åˆè¨ˆã‚„ã‚ŠãŸã„ã“ã¨ã®æ‰€è¦æ™‚é–“: ${usedHours.toLocaleString()} æ™‚é–“ï¼ˆç´„ ${usedDays} æ—¥ã€${usedPercent}%ï¼‰</p>`;
      html += `<p>ğŸ•“ æ®‹ã‚Šã®è‡ªç”±æ™‚é–“ï¼ˆæœªä½¿ç”¨ï¼‰: ${remainingFreeHours.toLocaleString()} æ™‚é–“ï¼ˆç´„ ${remainingFreeDays} æ—¥ã€${remainingPercent}%ï¼‰</p>`;

      if (tasks.length === 0) {
        html += '<p>ã‚„ã‚ŠãŸã„ã“ã¨ãŒã¾ã å…¥åŠ›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>';
        document.getElementById('shareButton').style.display = 'none';
      } else {
        html += '<table><tr><th>ã‚„ã‚ŠãŸã„ã“ã¨</th><th>æ‰€è¦æ™‚é–“</th></tr>';
        const data = tasks.map(task => task.hours);
        for (let i = 0; i < tasks.length; i++) {
          const days = (tasks[i].hours / 24).toFixed(1);
          html += `<tr><td>${tasks[i].name}</td><td>${tasks[i].hours.toLocaleString()} æ™‚é–“ï¼ˆç´„ ${days} æ—¥ï¼‰</td></tr>`;
        }
        html += '</table>';

        drawCharts(tasks.map(t => t.name), data);

        let taskSummary = tasks.map(t => `ãƒ»${t.name} ${t.hours}h`).join(' ');
        const baseText = `ç§ã¯ã‚ã¨ç´„${remainingDays.toLocaleString()}æ—¥ã€${totalFreeHours.toLocaleString()}æ™‚é–“ã®è‡ªç”±æ™‚é–“ãŒã‚ã‚‹ã‚‰ã—ã„ï¼\nâœ… ã‚„ã‚ŠãŸã„ã“ã¨ï¼š\n`;
        const limit = 280 - baseText.length - 30;
        let shortTasks = [...tasks];
        while (taskSummary.length > limit && shortTasks.length > 0) {
          shortTasks.pop();
          taskSummary = shortTasks.map(t => `ãƒ»${t.name} ${t.hours}h`).join(' ') + ' â€¦';
        }

        const tweetText = encodeURIComponent(baseText + taskSummary + '\nğŸ‘‰');
        const tweetUrl = `https://twitter.com/intent/tweet?text=${tweetText}&url=${location.href}`;
        document.getElementById('shareButton').innerHTML = `<a href="${tweetUrl}" target="_blank">ğŸ“£ çµæœã‚’Xã§ã‚·ã‚§ã‚¢ã™ã‚‹</a>`;
        document.getElementById('shareButton').style.display = 'block';
      }

      document.getElementById('result').innerHTML = html;
    }

    function drawCharts(labels, data) {
      if (pieChart) pieChart.destroy();
      if (barChart) barChart.destroy();

      const colors = ['#f66', '#6cf', '#6f6', '#fc6', '#ccc', '#c6f', '#f9c', '#9cf'];

      const pieCtx = document.getElementById('pieChart').getContext('2d');
      pieChart = new Chart(pieCtx, {
        type: 'pie',
        data: {
          labels: labels,
          datasets: [{
            data: data,
            backgroundColor: colors.slice(0, labels.length)
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'bottom' }
          }
        }
      });

      const barCtx = document.getElementById('barChart').getContext('2d');
      barChart = new Chart(barCtx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'æ‰€è¦æ™‚é–“ï¼ˆæ™‚é–“ï¼‰',
            data: data,
            backgroundColor: colors.slice(0, labels.length)
          }]
        },
        options: {
          responsive: true,
          indexAxis: 'y',
          scales: {
            x: { beginAtZero: true }
          }
        }
      });
    }
  </script></body>
</html>
